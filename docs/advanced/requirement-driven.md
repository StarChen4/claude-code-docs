# 需求驱动开发

采用需求先行的方法，使用 ClaudeCode 进行结构化的项目开发，提高项目管理效率和代码质量。

## 核心理念

**需求驱动开发**的核心思想：

1. **需求先行**：开发前明确需求
2. **文档化**：将需求记录在文档中
3. **步骤分解**：将需求分解为可执行步骤
4. **跟踪进度**：记录每个步骤的完成情况
5. **持续更新**：根据进展更新文档

## 项目结构

### 推荐的 docs 目录结构

```
project/
├── docs/
│   ├── 需求.md              # 项目总需求
│   ├── 架构设计.md          # 架构设计文档
│   ├── 开发计划.md          # 开发计划和进度
│   ├── API设计.md           # API 接口设计
│   ├── 数据库设计.md        # 数据库设计
│   └── 测试计划.md          # 测试计划
├── src/
└── .claude/
    └── memory.md            # 项目 Memory
```

## 需求文档模板

### 基础模板

创建 `docs/需求.md`：

```markdown
# 项目需求文档

## 项目概述
**项目名称**：用户管理系统
**版本**：v1.0
**开始日期**：2025-01-01
**预计完成**：2025-03-01

## 背景
[项目背景和目标]

## 核心功能
1. 用户注册和登录
2. 用户个人资料管理
3. 角色和权限管理
4. 用户活动日志

## 技术栈
- 后端：Node.js + Express
- 数据库：PostgreSQL
- 前端：React + TypeScript
- 认证：JWT

## 功能详细说明

### 1. 用户注册和登录
**优先级**：P0（最高）
**状态**：未开始

#### 需求描述
- 用户可以通过邮箱注册
- 支持邮箱验证
- 用户可以使用邮箱和密码登录
- 支持"记住我"功能

#### 验收标准
- [ ] 注册表单验证正确
- [ ] 邮箱验证流程正常
- [ ] 登录成功后获得 JWT token
- [ ] "记住我"功能正常工作

#### 技术实现
- 密码使用 bcrypt 加密
- JWT token 有效期 24 小时
- 邮箱验证 token 有效期 1 小时

### 2. 用户个人资料管理
**优先级**：P1
**状态**：未开始

[类似格式继续...]

## 非功能需求
- 性能：API 响应时间 < 200ms
- 安全：通过 OWASP Top 10 检查
- 可用性：99.9% uptime
- 可扩展性：支持 10万+ 用户

## 里程碑
- [ ] M1: 用户认证完成（Week 2）
- [ ] M2: 用户资料管理完成（Week 4）
- [ ] M3: 权限系统完成（Week 6）
- [ ] M4: 测试和优化完成（Week 8）

## 风险和挑战
1. 安全性要求高
2. 性能优化挑战
3. 第三方登录集成复杂度

## 变更记录
| 日期 | 版本 | 变更说明 |
|------|------|---------|
| 2025-01-01 | 1.0 | 初始版本 |
```

## 使用 ClaudeCode 开发

### 第一步：创建需求文档

```bash
> 根据以下需求创建需求文档：
> [描述项目需求]

[ClaudeCode 创建 docs/需求.md]
```

### 第二步：分解步骤

```bash
> 阅读 docs/需求.md，创建详细的开发计划

[ClaudeCode 创建 docs/开发计划.md]
```

示例开发计划：

```markdown
# 开发计划

## 第一阶段：基础设施（Week 1）
- [ ] 搭建项目结构
- [ ] 配置数据库
- [ ] 配置开发环境
- [ ] 设置 CI/CD

## 第二阶段：用户认证（Week 2-3）
### 后端
- [ ] 创建用户数据模型
- [ ] 实现注册 API
- [ ] 实现登录 API
- [ ] 实现 JWT 认证中间件
- [ ] 实现邮箱验证

### 前端
- [ ] 创建注册页面
- [ ] 创建登录页面
- [ ] 集成认证 API

### 测试
- [ ] 单元测试
- [ ] 集成测试
- [ ] E2E 测试

## 第三阶段：用户资料管理（Week 4-5）
[类似格式...]

## 第四阶段：权限系统（Week 6-7）
[类似格式...]

## 第五阶段：优化和部署（Week 8）
[类似格式...]
```

### 第三步：逐步实现

```bash
# 开始第一个任务
> 根据 docs/开发计划.md，实现第一阶段的第一个任务：搭建项目结构

[ClaudeCode 实现]

# 完成后更新文档
> 在 docs/开发计划.md 中标记"搭建项目结构"为已完成

# 继续下一个任务
> 实现下一个任务：配置数据库

[持续进行...]
```

## 工作流示例

### 新功能开发完整流程

```bash
# 1. 分析需求
> 我要添加"用户头像上传"功能，请先分析需求并更新需求文档

[ClaudeCode 分析并更新 docs/需求.md]

# 2. 制定计划
> 为"用户头像上传"功能制定详细的实现计划

[ClaudeCode 进入计划模式]
[制定详细计划]

# 3. 创建分支
> 创建功能分支 feature/avatar-upload

git checkout -b feature/avatar-upload

# 4. 实现后端
> 根据计划实现后端 API

[ClaudeCode 实现]
- 创建文件上传中间件
- 实现头像上传接口
- 添加图片处理功能

# 5. 实现前端
> 实现前端头像上传组件

[ClaudeCode 实现]
- 创建头像上传组件
- 集成上传 API
- 添加图片预览

# 6. 编写测试
> 为头像上传功能添加测试

[ClaudeCode 添加测试]

# 7. 更新文档
> 更新相关文档

[ClaudeCode 更新]
- API 文档
- 用户手册
- 变更日志

# 8. 提交和创建 PR
> 提交所有更改并创建 Pull Request

[ClaudeCode 提交并创建 PR]

# 9. 更新进度
> 在 docs/开发计划.md 中标记"用户头像上传"为已完成
```

## 项目模板

### 初始化项目模板

创建 `.claude/commands/init-project.md`：

```markdown
初始化新项目结构：

1. 创建 docs 目录和必要文档：
   - docs/需求.md
   - docs/架构设计.md
   - docs/开发计划.md
   - docs/API设计.md
   - docs/测试计划.md

2. 创建项目基础结构：
   - src/（源代码）
   - tests/（测试）
   - docs/（文档）
   - scripts/（脚本）

3. 初始化 Git 仓库

4. 创建 .gitignore

5. 创建 README.md

6. 配置 .claude/memory.md

请按步骤执行。
```

使用：

```bash
> /init-project
```

## 需求变更管理

### 记录变更

在 `docs/需求.md` 中添加变更记录：

```markdown
## 变更记录
| 日期 | 版本 | 变更说明 | 影响范围 | 状态 |
|------|------|---------|---------|------|
| 2025-01-15 | 1.1 | 添加第三方登录 | 认证模块 | 待开发 |
| 2025-01-20 | 1.2 | 修改密码策略 | 安全模块 | 已完成 |
```

### 处理变更

```bash
> 需求有变更：需要添加第三方登录功能

[ClaudeCode 分析影响]
分析结果：
- 影响认证模块
- 需要添加 OAuth 集成
- 预计增加 1 周开发时间

> 更新需求文档和开发计划

[ClaudeCode 更新文档]

> 根据新需求实现第三方登录

[ClaudeCode 实现]
```

## 进度跟踪

### 使用 Markdown CheckBox

在开发计划中使用复选框：

```markdown
## 本周任务（Week 3）
- [x] 实现用户注册 API
- [x] 实现用户登录 API
- [ ] 实现邮箱验证
- [ ] 添加单元测试

## 下周计划（Week 4）
- [ ] 用户资料页面
- [ ] 头像上传功能
- [ ] 资料编辑功能
```

### 自动更新进度

```bash
> 标记"实现用户注册 API"为已完成

[ClaudeCode 更新 docs/开发计划.md]
将对应项改为 [x]
```

## 文档驱动开发示例

### 完整项目示例

```bash
# === 项目启动阶段 ===

# 1. 初始化项目
> 创建一个"博客系统"项目，包括完整的文档结构

[ClaudeCode 创建项目结构和文档]

# 2. 细化需求
> 在 docs/需求.md 中详细描述博客系统的功能需求

[ClaudeCode 编写详细需求]

# 3. 架构设计
> 根据需求设计系统架构，更新 docs/架构设计.md

[ClaudeCode 设计架构]

# 4. API 设计
> 设计所有 API 接口，更新 docs/API设计.md

[ClaudeCode 设计 API]

# === 开发阶段 ===

# 5. 制定计划
> 根据需求和设计，制定详细的开发计划

[ClaudeCode 创建 docs/开发计划.md]

# 6. 开始开发
> 按照开发计划，实现第一个功能：用户系统

[ClaudeCode 实现]
[更新进度]

# 7. 持续迭代
> 继续下一个功能：文章管理

[ClaudeCode 实现]
[更新进度]

# === 测试阶段 ===

# 8. 测试
> 根据 docs/测试计划.md 执行测试

[ClaudeCode 执行测试]
[记录结果]

# === 部署阶段 ===

# 9. 部署准备
> 准备部署，生成部署文档

[ClaudeCode 创建部署文档]

# 10. 项目复盘
> 生成项目总结报告

[ClaudeCode 生成总结]
```

## 最佳实践

::: tip 需求驱动开发建议

1. **需求先行**：开发前必须有清晰的需求文档
2. **分解细化**：将大需求分解为小任务
3. **持续更新**：及时更新文档反映当前状态
4. **版本控制**：文档也纳入 Git 版本控制
5. **团队协作**：团队共享和维护文档
6. **定期审查**：定期审查需求和计划

:::

::: warning 常见陷阱

- 文档过时不更新
- 需求描述过于笼统
- 计划不够详细
- 忽视非功能需求
- 没有跟踪变更

:::

## 团队协作

### 多人项目

在项目 Memory 中定义协作规范：

```markdown
# 团队协作规范

## 文档维护
- 每个功能开发者负责更新相关文档
- 每周五更新开发计划进度
- 重大变更必须更新需求文档

## 分支策略
- 功能开发：feature/<feature-name>
- Bug 修复：fix/<bug-name>
- 文档更新：docs/<doc-name>

## 代码审查
- 所有 PR 必须包含文档更新
- PR 描述必须引用需求文档
- 审查时检查需求符合性

## 沟通机制
- 需求变更通过 Issue 讨论
- 技术决策记录在 docs/架构设计.md
- 每日站会同步进度
```

## 下一步

- [自定义命令](/advanced/custom-commands) - 创建项目管理命令
- [Git 集成](/advanced/git-integration) - Git 工作流集成
- [SubAgent 详解](/advanced/subagent) - 使用 Agent 管理项目
