# 模式切换

ClaudeCode 提供不同的工作模式来控制代码编辑的行为。理解并正确使用这些模式可以大大提高工作效率和安全性。

- 你可以使用 `Shift + Tab` 在各个模式之间切换。

## CLI 模式

### 1. Normal Mode（正常模式）

**默认模式**，适合大多数日常开发任务。

#### 特点
- 修改代码前会显示变更
- 需要用户确认后应用修改
- 平衡了自动化和控制

#### 适用场景
- 日常开发任务
- 需要审查每次修改的场景
- 学习和探索代码库

#### 使用方式

```bash
claude  # 默认就是 Normal Mode
```

#### 工作流程

```bash
> 添加一个登录功能

Claude: 我将创建登录功能...
[显示要修改的代码]
是否应用这些修改？[y/N]

> y
[应用修改]
```

### 2. Accept Edits（自动应用编辑）

自动应用所有代码修改，无需每次确认。

#### 特点
- 自动应用所有编辑
- 无需手动确认
- 提高效率但降低控制

#### 适用场景
- 信任 ClaudeCode 的场景
- 快速迭代开发
- 自动化脚本
- 有 Git 保护的项目（可随时回滚）

#### 使用方式

启动时设置或在会话中切换到此模式。

#### 注意事项

::: warning 使用建议
- 确保项目使用 Git 版本控制
- 定期提交代码，便于回滚
- 重要修改前先提交
- 适合熟悉的项目
:::

### 3. Plan Mode（计划模式）

在执行任务前先制定详细计划，等待用户批准后再执行。

#### 特点
- 先规划后执行
- 用户可审查完整计划
- 最高的控制和安全性
- 适合复杂任务

#### 适用场景
- 复杂功能开发
- 大规模重构
- 多文件修改
- 架构设计
- 不确定需求的任务

#### 使用方式

ClaudeCode 会在需要时自动进入计划模式，或者你可以明确要求：

```bash
> 请先制定计划：重构用户认证模块
```

#### 工作流程

1. **分析需求**：理解任务要求
2. **制定计划**：生成详细的执行步骤
3. **用户审查**：展示计划供用户审核
4. **用户批准**：确认是否执行
5. **执行计划**：按步骤实施
6. **持续反馈**：执行过程中报告进度

#### 示例

```bash
> 重构整个数据库访问层

[ClaudeCode 进入计划模式]

Claude: 我将制定一个计划来重构数据库访问层...

## 计划

### 第一阶段：分析现状
1. 分析现有数据库访问代码
2. 识别重复和问题代码
3. 确定重构范围

### 第二阶段：设计架构
1. 设计新的 DAO 层结构
2. 创建基础接口和抽象类
3. 定义数据访问规范

### 第三阶段：实施重构
1. 创建新的数据访问层
2. 逐个迁移现有功能
3. 更新调用代码

### 第四阶段：测试验证
1. 添加单元测试
2. 运行集成测试
3. 性能测试

### 第五阶段：文档和清理
1. 更新文档
2. 删除旧代码
3. 代码审查

是否批准此计划？[y/N]
```

## VSCode 插件模式

### 1. Ask before edits（编辑前询问）

每次修改代码前都会询问用户确认。

#### 特点
- 最大控制权
- 每次编辑都需确认
- 适合谨慎操作

#### 适用场景
- 生产代码修改
- 不熟悉的代码库
- 学习和探索
- 安全敏感的项目

#### 使用方式

在 VSCode 插件设置中选择 "Ask before edits" 模式。

### 2. Edit automatically（自动编辑）

自动应用 ClaudeCode 建议的所有修改。

#### 特点
- 完全自动化
- 无需手动确认
- 最高效率

#### 适用场景
- 快速开发迭代
- 信任的项目环境
- 原型开发
- 有 Git 保护的项目

#### 使用方式

在 VSCode 插件设置中选择 "Edit automatically" 模式。

::: tip 自动编辑建议
使用 "Edit automatically" 时：
- 确保启用 Git 自动保存
- 定期查看 Git diff
- 随时准备回滚（Ctrl+Z 或 git reset）
- 在小范围内测试后再扩大使用
:::

### 3. Plan Mode（计划模式）

与 CLI 的 Plan Mode 相同，先制定计划再执行。

#### VSCode 特色

在 VSCode 插件中，Plan Mode 提供：
- 可视化的计划展示
- 步骤进度追踪
- 更好的代码差异展示
- 集成的编辑器内体验

## 模式对比

### CLI 模式对比

| 特性 | Normal Mode | Accept Edits | Plan Mode |
|------|------------|--------------|-----------|
| 执行速度 | ⚡ 中 | ⚡⚡ 快 | 🐢 慢 |
| 控制程度 | ⚠️ 中 | ⚠️ 低 | ✅ 高 |
| 需要确认 | 每次编辑 | 不需要 | 仅计划 |
| 适合任务 | 日常开发 | 快速迭代 | 复杂任务 |
| 安全性 | ⚠️ 中 | ⚠️ 低 | ✅ 高 |

### VSCode 模式对比

| 特性 | Ask before edits | Edit automatically | Plan Mode |
|------|------------------|-------------------|-----------|
| 执行速度 | ⚡ 中 | ⚡⚡ 快 | 🐢 慢 |
| 控制程度 | ✅ 高 | ⚠️ 低 | ✅ 高 |
| 需要确认 | 每次编辑 | 不需要 | 仅计划 |
| 适合任务 | 谨慎操作 | 快速开发 | 复杂任务 |
| 安全性 | ✅ 高 | ⚠️ 低 | ✅ 高 |

## 模式选择建议

### 根据任务复杂度选择

```
简单任务（单文件小改动）
    ↓
Normal Mode / Ask before edits

中等任务（多文件修改）
    ↓
Normal Mode（谨慎）或 Accept Edits（快速）

复杂任务（重构/新功能）
    ↓
Plan Mode
```

### 根据项目阶段选择

```
探索/学习阶段
    ↓
Ask before edits（仔细查看每次修改）

快速开发阶段
    ↓
Edit automatically / Accept Edits（快速迭代）

重构/优化阶段
    ↓
Plan Mode（系统性规划）

生产维护阶段
    ↓
Ask before edits（谨慎修改）
```

### 根据信任程度选择

```
新项目/不熟悉的代码
    ↓
Ask before edits（学习和理解）

熟悉的项目
    ↓
Normal Mode / Accept Edits

关键业务代码
    ↓
Ask before edits + Plan Mode

个人项目/实验性代码
    ↓
Edit automatically（快速试错）
```

## 实战案例

### 案例 1：日常 Bug 修复（Normal Mode）

```bash
> 修复登录按钮点击无响应的问题

Claude: 我发现问题是事件监听器没有正确绑定...
[显示修改]
是否应用？[y/N]

> y
[应用修改]
```

### 案例 2：快速原型开发（Accept Edits）

```bash
# 使用 Accept Edits 模式
> 创建一个简单的 Todo 应用

[ClaudeCode 快速创建文件和代码]
[自动应用所有修改]
[无需逐次确认]

完成！Todo 应用已创建
```

### 案例 3：系统重构（Plan Mode）

```bash
> 将整个项目从 JavaScript 迁移到 TypeScript

[ClaudeCode 进入 Plan Mode]

## 迁移计划

### 第一步：准备工作（预计 1 小时）
- 安装 TypeScript 依赖
- 配置 tsconfig.json
- 配置构建工具

### 第二步：类型定义（预计 2 小时）
- 创建全局类型定义
- 定义接口和类型
- 创建类型工具函数

### 第三步：渐进式迁移（预计 8 小时）
- 迁移工具函数（utils/）
- 迁移组件（components/）
- 迁移页面（pages/）
- 迁移服务（services/）

### 第四步：类型检查和修复（预计 3 小时）
- 修复类型错误
- 添加缺失的类型注解
- 优化类型定义

### 第五步：测试和验证（预计 2 小时）
- 运行所有测试
- 修复测试错误
- 验证功能完整性

是否批准此计划？
```

### 案例 4：VSCode 探索代码（Ask before edits）

```
用户在 VSCode 中：
"解释并优化这个函数"

[ClaudeCode 分析代码]
[提出优化建议]
[显示代码差异]

VSCode 提示：是否应用这些更改？
- Accept（接受）
- Reject（拒绝）
- Edit（手动编辑）
```

## 最佳实践

::: tip 模式使用建议

1. **初学者**：使用 Ask before edits，学习 ClaudeCode 如何修改代码
2. **日常开发**：使用 Normal Mode，平衡效率和控制
3. **快速原型**：使用 Accept Edits / Edit automatically
4. **重要重构**：使用 Plan Mode，确保方向正确
5. **团队协作**：优先使用 Ask before edits 或 Plan Mode

:::

::: warning 安全注意事项

- 使用自动模式前确保启用 Git
- 定期查看 Git diff 了解修改
- 重要修改前先提交代码
- 不熟悉的代码库使用 Ask before edits
- Plan Mode 下仔细审查计划

:::

## 常见问题

### Q: 如何选择合适的模式？

**A:** 根据任务复杂度、项目重要性和个人熟悉程度：
- 简单任务 + 熟悉项目 → Accept Edits
- 复杂任务 → Plan Mode
- 不确定时 → Normal Mode / Ask before edits

### Q: Plan Mode 和其他模式可以混用吗？

**A:** 可以。ClaudeCode 会在需要时自动进入 Plan Mode，你也可以手动切换。

### Q: Accept Edits 会不会误删重要代码？

**A:** 有风险，因此：
- 使用 Git 版本控制
- 定期提交代码
- 查看 Git diff
- 重要项目谨慎使用

### Q: VSCode 和 CLI 的模式有什么区别？

**A:** 功能相同，但：
- VSCode 提供可视化界面
- VSCode 更容易查看代码差异
- 一些高级功能需要在 CLI中执行
- CLI 更适合自动化和脚本

## 下一步

- [基本命令](/guide/basic-commands) - 学习常用命令
- [Memory 使用](/advanced/memory) - 配置工作偏好
- [权限管理](/advanced/permissions) - 控制 ClaudeCode 权限
